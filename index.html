<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subham Fancy Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .form-section {
      display: none;
    }
    .form-section.active {
      display: block;
    }
    .nav-tab.active {
      background-color: #dc2626; /* red-600 */
    }
    .message.success {
      color: #059669; /* green-600 */
    }
    .message.error {
      color: #dc2626; /* red-600 */
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-400 to-purple-600 p-5 font-sans">
  <div class="max-w-md mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden">
    <div class="bg-gray-800 text-white p-6 text-center">
      <h1 class="text-xl font-bold">Subham Fancy Store</h1>
      <p class="text-sm opacity-80">Business Management System</p>
    </div>

    <div class="flex bg-gray-700">
      <button class="nav-tab flex-1 p-3 text-white hover:bg-gray-600 active:bg-red-500" onclick="showTab(event, 'sale')">Sales</button>
      <button class="nav-tab flex-1 p-3 text-white hover:bg-gray-600" onclick="showTab(event, 'expense')">Expenses</button>
      <button class="nav-tab flex-1 p-3 text-white hover:bg-gray-600" onclick="showTab(event, 'loan')">Loans</button>
      <button class="nav-tab flex-1 p-3 text-white hover:bg-gray-600" onclick="showTab(event, 'due')">Dues</button>
      <button class="nav-tab flex-1 p-3 text-white hover:bg-gray-600" onclick="showTab(event, 'dashboard')">Dashboard</button>
    </div>

    <!-- Forms Container -->
    <div class="p-6">

      <!-- Sales -->
      <div id="sale-form" class="form-section active">
        <h2 class="text-xl font-bold mb-4">Add Sale</h2>
        <form id="saleForm" class="space-y-4">
          <div>
            <label for="productName" class="block font-semibold text-gray-700 mb-1">Product Name</label>
            <input id="productName" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500 focus:outline-none" />
          </div>
          <div>
            <label for="costPrice" class="block font-semibold text-gray-700 mb-1">Cost Price (₹)</label>
            <input type="number" id="costPrice" step="0.01" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500 focus:outline-none" />
          </div>
          <div>
            <label for="sellingPrice" class="block font-semibold text-gray-700 mb-1">Selling Price (₹)</label>
            <input type="number" id="sellingPrice" step="0.01" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500 focus:outline-none" />
          </div>
          <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg">Add Sale</button>
        </form>
        <div id="sale-message" class="mt-3 text-center font-semibold hidden"></div>
      </div>

      <!-- Expenses -->
      <div id="expense-form" class="form-section">
        <h2 class="text-xl font-bold mb-4">Add Expense</h2>
        <form id="expenseForm" class="space-y-4">
          <div>
            <label for="description" class="block font-semibold text-gray-700 mb-1">Description</label>
            <input id="description" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500" />
          </div>
          <div>
            <label for="category" class="block font-semibold text-gray-700 mb-1">Category</label>
            <select id="category" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500">
              <option value="">Select Category</option>
              <option>Rent</option>
              <option>Utilities</option>
              <option>Supplies</option>
              <option>Staff</option>
              <option>Maintenance</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label for="amount" class="block font-semibold text-gray-700 mb-1">Amount (₹)</label>
            <input type="number" id="amount" step="0.01" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500" />
          </div>
          <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg">Add Expense</button>
        </form>
        <div id="expense-message" class="mt-3 text-center font-semibold hidden"></div>
      </div>

      <!-- Loans -->
      <div id="loan-form" class="form-section">
        <h2 class="text-xl font-bold mb-4">Loan Management</h2>
        <form id="loanForm" class="space-y-4">
          <div>
            <label for="loanType" class="block font-semibold text-gray-700 mb-1">Type</label>
            <select id="loanType" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500">
              <option value="">Select Type</option>
              <option>Loan Taken</option>
              <option>Loan Repaid</option>
            </select>
          </div>
          <div>
            <label for="person" class="block font-semibold text-gray-700 mb-1">Person/Organization</label>
            <input id="person" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500" />
          </div>
          <div>
            <label for="loanAmount" class="block font-semibold text-gray-700 mb-1">Amount (₹)</label>
            <input type="number" id="loanAmount" step="0.01" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500" />
          </div>
          <div>
            <label for="status" class="block font-semibold text-gray-700 mb-1">Status</label>
            <select id="status" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500">
              <option>Pending</option>
              <option>Completed</option>
              <option>Overdue</option>
            </select>
          </div>
          <div>
            <label for="loanNotes" class="block font-semibold text-gray-700 mb-1">Notes (Optional)</label>
            <textarea id="loanNotes" rows="3" class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500"></textarea>
          </div>
          <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg">Add Loan Entry</button>
        </form>
        <div id="loan-message" class="mt-3 text-center font-semibold hidden"></div>
      </div>

      <!-- Dues -->
      <div id="due-form" class="form-section">
        <h2 class="text-xl font-bold mb-4">Due Management</h2>
        <form id="dueForm" class="space-y-4">
          <div>
            <label for="customerName" class="block font-semibold text-gray-700 mb-1">Customer Name</label>
            <input id="customerName" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500" />
          </div>
          <div>
            <label for="dueAmount" class="block font-semibold text-gray-700 mb-1">Amount Due (₹)</label>
            <input type="number" id="dueAmount" step="0.01" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500" />
          </div>
          <div>
            <label for="dueStatus" class="block font-semibold text-gray-700 mb-1">Status</label>
            <select id="dueStatus" required class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500">
              <option>Pending</option>
              <option>Paid</option>
              <option>Overdue</option>
            </select>
          </div>
          <div>
            <label for="dueNotes" class="block font-semibold text-gray-700 mb-1">Notes (Optional)</label>
            <textarea id="dueNotes" rows="3" class="w-full border-2 border-gray-200 rounded-lg p-2 focus:border-blue-500"></textarea>
          </div>
          <button type="submit" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg">Add Due Entry</button>
        </form>
        <div id="due-message" class="mt-3 text-center font-semibold hidden"></div>
      </div>

      <!-- Dashboard -->
      <div id="dashboard-form" class="form-section">
        <h2 class="text-xl font-bold mb-4 text-center">Business Dashboard</h2>
        <div class="grid grid-cols-2 gap-4 mb-5">
          <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
            <div id="totalSales" class="text-2xl font-bold text-gray-800">0</div>
            <div class="text-gray-500 text-sm">Total Sales</div>
          </div>
          <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-blue-500">
            <div id="totalProfit" class="text-2xl font-bold text-gray-800">₹0</div>
            <div class="text-gray-500 text-sm">Total Profit</div>
          </div>
          <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-green-600">
            <div id="savings" class="text-2xl font-bold text-gray-800">₹0</div>
            <div class="text-gray-500 text-sm">Savings (40%)</div>
          </div>
          <div class="bg-gray-100 p-4 rounded-lg border-l-4 border-red-500">
            <div id="reinvestment" class="text-2xl font-bold text-gray-800">₹0</div>
            <div class="text-gray-500 text-sm">Reinvestment (60%)</div>
          </div>
        </div>
        <button class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 rounded-lg" onclick="loadDashboard()">Refresh Data</button>
      </div>

    </div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyPfYYTsnnNFXA8asOqfYqDAgRS0KTlhNanQ-OxgMnzbZ8tfesHoNDCe8tINGX7bi7DYA/exec';

    function showTab(event, tabName) {
      // Hide all forms
      document.querySelectorAll('.form-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected form and activate tab
      document.getElementById(tabName + '-form').classList.add('active');
      event.target.classList.add('active');
      
      // If dashboard is selected, load dashboard data
      if (tabName === 'dashboard') {
        loadDashboard();
      }
    }

    // Sales Form Handler
    document.getElementById('saleForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      await submitForm('sale', {
        productName: document.getElementById('productName').value,
        costPrice: parseFloat(document.getElementById('costPrice').value),
        sellingPrice: parseFloat(document.getElementById('sellingPrice').value)
      }, 'sale-message');
    });

    // Expense Form Handler
    document.getElementById('expenseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      await submitForm('expense', {
        description: document.getElementById('description').value,
        category: document.getElementById('category').value,
        amount: parseFloat(document.getElementById('amount').value)
      }, 'expense-message');
    });

    // Loan Form Handler
    document.getElementById('loanForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      await submitForm('loan', {
        type: document.getElementById('loanType').value,
        person: document.getElementById('person').value,
        amount: parseFloat(document.getElementById('loanAmount').value),
        status: document.getElementById('status').value,
        notes: document.getElementById('loanNotes').value
      }, 'loan-message');
    });

    // Due Form Handler
    document.getElementById('dueForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      await submitForm('due', {
        customerName: document.getElementById('customerName').value,
        amount: parseFloat(document.getElementById('dueAmount').value),
        status: document.getElementById('dueStatus').value,
        notes: document.getElementById('dueNotes').value
      }, 'due-message');
    });

    async function submitForm(type, data, messageElementId) {
      const messageElement = document.getElementById(messageElementId);
      const button = event.target.querySelector('button');
      
      try {
        button.disabled = true;
        button.textContent = 'Saving...';
        
        const response = await fetch(API_URL, {
          redirect: "follow",
          method: 'POST',
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
          body: JSON.stringify({
            type: type,
            ...data
          })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
          messageElement.textContent = result.message;
          messageElement.className = 'mt-3 text-center font-semibold message success';
          messageElement.classList.remove('hidden');
          event.target.reset();
        } else {
          throw new Error(result.message);
        }
        
      } catch (error) {
        messageElement.textContent = 'Error: ' + error.message;
        messageElement.className = 'mt-3 text-center font-semibold message error';
        messageElement.classList.remove('hidden');
      } finally {
        button.disabled = false;
        button.textContent = getButtonText(type);
        
        // Clear message after 3 seconds
        setTimeout(() => {
          messageElement.textContent = '';
          messageElement.className = 'mt-3 text-center font-semibold hidden';
        }, 3000);
      }
    }

    function getButtonText(type) {
      const buttonTexts = {
        'sale': 'Add Sale',
        'expense': 'Add Expense',
        'loan': 'Add Loan Entry',
        'due': 'Add Due Entry'
      };
      return buttonTexts[type];
    }

    async function loadDashboard() {
      try {
        const response = await fetch(API_URL + '?type=dashboard', {
          redirect: "follow",
          method: 'GET',
          headers: {
            "Content-Type": "text/plain;charset=utf-8",
          },
        });
        const data = await response.json();
        
        document.getElementById('totalSales').textContent = data.totalSales || 0;
        document.getElementById('totalProfit').textContent = '₹' + (data.totalProfit || 0).toFixed(2);
        document.getElementById('savings').textContent = '₹' + (data.savings || 0).toFixed(2);
        document.getElementById('reinvestment').textContent = '₹' + (data.reinvestment || 0).toFixed(2);
      } catch (error) {
        console.error('Error loading dashboard:', error);
        // Set default values if dashboard fails to load
        document.getElementById('totalSales').textContent = '0';
        document.getElementById('totalProfit').textContent = '₹0';
        document.getElementById('savings').textContent = '₹0';
        document.getElementById('reinvestment').textContent = '₹0';
      }
    }

    // Initialize the first tab as active
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelector('.nav-tab').classList.add('active');
      document.getElementById('sale-form').classList.add('active');
      loadDashboard();
    });
  </script>
</body>
</html>
